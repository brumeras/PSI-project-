@page "/counter"
@using KNOTS.Services
@inject UserService UserService

<h3>Counter</h3>

@if (UserService.IsAuthenticated)
{
    <p>Logged in as: <b>@UserService.CurrentUser</b></p>
    <p>Friends count: @UserService.GetUserFriends().Count</p>
    <button class="btn btn-secondary" @onclick="Logout">Logout</button>
}
else
{
    <p>You are not logged in.</p>

    <div class="mb-2">
        <input @bind="username" placeholder="Username" class="form-control" />
    </div>
    <div class="mb-2">
        <input @bind="password" type="password" placeholder="Password" class="form-control" />
    </div>
    <div class="mb-2">
        <button class="btn btn-primary me-2" @onclick="Login">Login</button>
        <button class="btn btn-success" @onclick="Register">Register</button>
    </div>

    <p>@statusMessage</p>
}

<hr />

<p>Total registered users: @UserService.GetTotalUsersCount()</p>

@code {
    private string username = string.Empty;
    private string password = string.Empty;
    private string statusMessage = string.Empty;

    private void Login()
    {
        var result = UserService.LoginUser(username, password);
        statusMessage = result.Message;
    }

    private void Register()
    {
        var result = UserService.RegisterUser(username, password);
        statusMessage = result.Message;
    }

    private void Logout()
    {
        UserService.LogoutUser();
        statusMessage = "You have logged out successfully.";
    }
}